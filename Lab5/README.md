> **Merge** – процесс слияния нескольких **Restore Point**, в результате которого, получается один **Restore Point**
> 

<aside>
‼️ Реализация данной лабораторной должна основываться на реализации лабораторной 3. Делать изменения в код лабораторной 3 - запрещено.

</aside>

### Сохранение и загрузка данных

Система должна поддерживать загрузку своего состояния после перезапуска программы. Это может быть реализовано за счёт сохранения данных о настройках **Backup Task** в конфигурационный файл, лежащий в корневой директории. После загрузки ожидается, что в приложение загрузится информация о существующих **Backup Task**, добавленных в них **Backup Object**, созданных **Restore Point** и остальная информация.

### Алгоритмы очистки Restore Point

Помимо создания, нужно контролировать количество созданных **Restore Point**. Чтобы не допускать накопления большого количества старых и не актуальных **Restore Point**, требуется реализовать механизмы их очистки, они должны контролировать, что набор существующих **Restore Point** соответсвует заданному лимиту.

В рамках данной лабораторной необходимо реализовать следующие виды лимитов:

1. По количеству **Restore Point** – храним коллекцию из последних **N** элементов, очищаем остальные.
2. По дате – ограничивает промежуток времени на котором хранятся **Restore Point**, элементы старее данного промежутка - очищаются.
3. Гибридный лимит – пользователь может указывать как комбинировать лимиты: удалять **Restore Point** если он подходит под все требования/хотя бы под одно.

Например пользователь выбирает гибрид лимитов “по количеству” и “по дате”. Под критерии первого лимита подходят точки: `P4`, `P5`. Под критерии второго - `P4`. При гибриде “под все” будет очищена точка `P4`, при гибриде “хотя бы под одно” будут очищены точки `P4`, `P5`.

Ситуация, когда для соответствия лимиту, должны быть удалены все точки - должна обрабатываться.

### Merge

Стоит разделять алгоритм выбора точек для удаления и процесс удаления. Требуется поддержать альтернативное поведение при выходе за лимиты - **Merge**. 

**Merge** работает по правилам:

- Если в старой точке есть объект и в новой точке есть объект - нужно оставить новый, а старый можно удалять
- Если в старой точке есть объект, а в новой его нет - нужно перенести его в новую точку
- Если в точке объекты хранятся по правилу Single storage, то старая точка просто удаляется

### Logging

Логика работы **Backup Task** не должна напрямую завязываться на консоль или другие внешние компоненты. Чтобы поддержать возможность уведомлять пользователя о событиях внутри алгоритма, требуется реализовать интерфейс для логирования и вызывать его в нужных моментах. Например, писать что создается **Storage** или **Restore Point**. 

Задаваться способ логирования должен извне. Например, при создании **Backup Task**. В рамках системы ожидаются такие реализации логера:

- Консольный, который логирует информацию в консоль
- Файловый, который логирует в указанный файл

Для логирования сущностей стоит реализовать в самих сущностях методы, которые генерируют информативную строку, которая описывает сущность.

Для логера стоит поддержать возможность конфигурации - указать нужно ли делать префикс с таймкодом в начале строки.

### Восстановление

Целью создания резервных копий является предоставление возможности восстановиться из них. 

Требуется реализовать функционал, который бы позволял указать **Restore Point** и восстановить данные из него. 

Нужно поддержать два режима восстановления:

- to original location - восстановить файл в то место, где находились отслеживаемый **Backup Object** (и заменить, если они ещё существуют)
- to different location - восстановить файл в указанный **Repository**

### Notes

1. Для проверки работоспособности алгоритма работы со временем нужно спроектировать систему так, чтобы в тестах была возможность созданным объектам задавать время создания.
